<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generador de QR con Logo</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
    :root {
        --bg-color: #ffffff;
        --text-color: #333;
        --container-bg: #f5f5f5;
        --button-bg: #311e77;
        --button-color: #fff;
        --button-hover: #171870;
    }

    body.dark {
        --bg-color: #0f0f0f;
        --text-color: #eee;
        --container-bg: #1c1c1c;
        --button-bg: #667eea;
        --button-color: #fff;
        --button-hover: #5463ff;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }

    body {
        background: var(--bg-color);
        color: var(--text-color);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        transition: all 0.3s;
    }

    .container {
        background: var(--container-bg);
        border-radius: 20px;
        padding: 30px 25px;
        width: 100%;
        max-width: 500px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        transition: all 0.3s;
    }

    h1 { text-align: center; margin-bottom: 20px; font-size: 26px; }

    .input-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 6px; font-weight: bold; }
    textarea, select {
        width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #ccc;
        font-size: 16px; resize: vertical; transition: border-color 0.3s;
    }
    textarea:focus, select:focus { border-color: var(--button-bg); outline: none; }

    .qr-container {
        text-align: center;
        margin: 20px 0;
        padding: 15px;
        border: 2px dashed #ccc;
        border-radius: 10px;
        min-height: 260px;
        display: flex; justify-content: center; align-items: center;
        position: relative;
        overflow: hidden;
        background: #fff;
    }

    #qrcode { max-width: 100%; display: none; }
    .buttons { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
    button {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        color: var(--button-color);
        background: var(--button-bg);
    }
    button:hover { background: var(--button-hover); transform: translateY(-2px); }
    button:active { transform: translateY(0); }
    button:disabled { opacity: 0.5; cursor: not-allowed; }

    .hidden { display: none; }
    .notification {
        position: fixed; top: 20px; right: 20px; padding: 12px 18px;
        border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        z-index: 9999; color: #fff; animation: slideIn 0.3s ease;
    }
    .notification.error { background: #f44336; }
    .notification.success { background: #4CAF50; }
    .notification.info { background: #2196F3; }

    @keyframes slideIn { from { transform: translateX(100%); opacity:0;} to { transform: translateX(0); opacity:1; } }

    @media (max-width: 600px) {
        h1 { font-size: 22px; }
        .buttons { flex-direction: column; }
    }

    #themeToggle {
        margin-bottom: 15px;
        background: #888; color: #fff;
        font-size: 12px; padding: 6px; width: 100%;
    }
</style>
</head>
<body>
<div class="container">
    <h1>Generador de QR con Logo</h1>
    <button id="themeToggle">Cambiar Modo</button>

    <div class="input-group">
        <label for="qrText">Texto o URL:</label>
        <textarea id="qrText" placeholder="Introduce texto, URL, email, teléfono, WiFi..."></textarea>
    </div>

    <div class="input-group">
        <label for="qrSize">Tamaño del QR:</label>
        <select id="qrSize">
            <option value="128">128x128</option>
            <option value="256" selected>256x256</option>
            <option value="400">400x400</option>
        </select>
    </div>

    <div class="input-group">
        <label for="logoInput">Logo (opcional):</label>
        <input type="file" id="logoInput" accept="image/*">
    </div>

    <div class="qr-container">
        <div id="placeholder">Aquí aparecerá tu QR</div>
        <div id="qrcode"></div>
    </div>

    <div class="buttons">
        <button id="generateBtn">Generar QR</button>
        <button id="downloadBtn" class="hidden" disabled>Descargar QR</button>
        <button id="clearBtn" class="hidden">Limpiar</button>
    </div>
</div>

<script>
let currentQR = null;
let logoDataURL = null;

const qrText = document.getElementById('qrText');
const qrSize = document.getElementById('qrSize');
const qrcodeDiv = document.getElementById('qrcode');
const placeholder = document.getElementById('placeholder');
const generateBtn = document.getElementById('generateBtn');
const downloadBtn = document.getElementById('downloadBtn');
const clearBtn = document.getElementById('clearBtn');
const logoInput = document.getElementById('logoInput');
const themeToggle = document.getElementById('themeToggle');

logoInput.addEventListener('change', function(e){
    const file = e.target.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = function(ev){ logoDataURL = ev.target.result; }
        reader.readAsDataURL(file);
    } else { logoDataURL = null; }
});

themeToggle.addEventListener('click', ()=>{
    document.body.classList.toggle('dark');
});

generateBtn.addEventListener('click', generateQR);
downloadBtn.addEventListener('click', downloadQR);
clearBtn.addEventListener('click', clearQR);

function generateQR(){
    const text = qrText.value.trim();
    const size = parseInt(qrSize.value);
    if(!text) return showNotification('Introduce texto o URL', 'error');

    qrcodeDiv.innerHTML = '';
    qrcodeDiv.style.display = 'block';
    placeholder.style.display = 'none';

    const canvas = document.createElement('canvas');
    canvas.width = size; canvas.height = size;
    const ctx = canvas.getContext('2d');

    const tempDiv = document.createElement('div');
    new QRCode(tempDiv, { text, width:size, height:size, correctLevel:QRCode.CorrectLevel.H });

    setTimeout(()=>{
        const qrCanvas = tempDiv.querySelector('canvas');
        if(!qrCanvas) return showNotification('Error generando QR', 'error');

        ctx.drawImage(qrCanvas,0,0,size,size);

        if(logoDataURL){
            const img = new Image();
            img.src = logoDataURL;
            img.onload = function(){
                const logoSize = size*0.2;
                ctx.drawImage(img,(size-logoSize)/2,(size-logoSize)/2,logoSize,logoSize);
                renderCanvas(canvas);
            }
        } else { renderCanvas(canvas); }
    },100);
}

function renderCanvas(canvas){
    qrcodeDiv.innerHTML=''; qrcodeDiv.appendChild(canvas);
    downloadBtn.classList.remove('hidden'); downloadBtn.disabled=false;
    clearBtn.classList.remove('hidden');
    currentQR={text: qrText.value, size: parseInt(qrSize.value)};
    showNotification('QR generado', 'success');
}

function downloadQR(){
    if(!currentQR) return showNotification('Genera primero el QR', 'error');
    const canvas = qrcodeDiv.querySelector('canvas');
    if(!canvas) return showNotification('Error descargando', 'error');

    const link=document.createElement('a');
    link.download=`QR_${Date.now()}.png`;
    link.href=canvas.toDataURL();
    document.body.appendChild(link); link.click(); link.remove();
}

function clearQR(){
    qrcodeDiv.innerHTML=''; placeholder.style.display='block'; qrcodeDiv.style.display='none';
    qrText.value=''; logoInput.value=''; logoDataURL=null;
    downloadBtn.classList.add('hidden'); clearBtn.classList.add('hidden');
    currentQR=null;
    showNotification('QR limpiado', 'info');
}

function showNotification(msg,type='success'){
    const old=document.querySelector('.notification'); if(old) old.remove();
    const n=document.createElement('div'); n.className=`notification ${type}`; n.textContent=msg;
    document.body.appendChild(n); setTimeout(()=>{ n.remove(); },3000);
}
</script>
</body>
</html>
